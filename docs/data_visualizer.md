# Data Visualizer

This file provides details on how to setup the web visualizer for viewing the extracted data.

## Setup

### Data storage hierarchy

The web visualizer expects the data to be stored in the followig hierarchy

```
<datastore>/wwe/raw/<vendor>/<phase>/<location>/<day>/<timestamp>
```

for example

```
/datastore05/wwe/raw/intel/phase1/bangalore/2018-05-07/2018-05-07_12-01-06
```

### Database setup

The visualizer uses mongodb to index and store all the collected rosbags metadata. The "data_visualizer/app/models.py" and "data_processing/model/RawBagfile.py" defines a model that is used by the database. As you can see from the defined model structure, it stores only the bag's meta data and not any of the extracted sensor data. All extracted sensor data resided on disks and is retrieved using this metadata from the database.

As pre-requisites, install and setup mongodb and mongoengine on your system.

#### updating the database
This expects data to be extracted using the provided 'extract_data.py' script with the "all" option and also expectes the data to be stored and organized in the hierarchy defined above. With that done, use the 'updatedb.py' to update all the extracted bagfile info using its corresponding info.json files generated by the extraction script. For example:

```
$python ./data_processing/data_extraction/updatedb.py all /datastore05/ -v
```

This will recursively search for all info.json files in /datastore05/ and updated them in the database. You can use 'single' option to update each file individually. And you can use the 'flush' option to clean all entries in the database.

### Running the web service

Once the database is setup, you can start the web service be running the 'data_visualizer/run.py'. This requires a bunch of python modules to be installed. Use the provided data_visualizer/condaenv.yml file to create a conda env with all dependencies. Also, Update data_visualizer/config.py to point the datastores to your required locations.

```
$ conda activate wwe_flask
$ python ./data_visualizer/run.py
```

Once the server is running, you can view the webpage in your browser at http://<hostname>:5000/.
